<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<link rel="stylesheet" href="{{ url_for('static', filename='common.css') }}" />
		<title>PSEUDOTUBE</title>
	</head>
	<body>
		<!-- Top Bar -->
		<header class="top-bar">
			<a href="/" class="logo">PSEUDOTUBE</a>

			<div class="text-bar">
				<input id="search-bar-input" type="text" class="input-text" placeholder="Search...">
			</div>

			<div class="right-section">
				{% if user.is_authenticated %}

				<button id="upload-button" class="btn red">Upload</button>

				<div class="btn-group">
					<p class="pill-button gray">
					<img src={{user.picture}} class="picture">
					{{user.email}}
					</p>
					<a href="{{ url_for('route_logout') }}" class="pill-button black" title="Logout">‚çà</a>
				</div>

				<div class="modal-overlay">
					<button id="upload-modal-close-button" class="btn gray modal-close">&times;</button>

					<div class="modal">
						<h2 class="modal-title">Upload File</h2>
						<p class="modal-description">Please choose a file to upload. You can also drag and drop it below.</p>

						<form class="upload-form" action="{{ url_for('route_upload') }}" method="post" enctype="multipart/form-data">
							<div class="form-group">
								<label for="video-title">Title</label>
								<input type="text" id="video-title" name="video-title" class="input-text" required>
							</div>

							<div class="form-group">
								<label for="video-desc">Description</label>
								<textarea id="video-desc" name="video-desc" class="textarea" rows="4" required></textarea>
							</div>

							<label for="file-upload" class="upload-area">
								<input type="file" id="file-upload" name="file-upload" hidden required />
								<span>Click or drag file here to upload</span>
							</label>

							<button type="submit" class="btn red">Submit</button>
						</form>
					</div>
				</div>
				{% else %}
				<a href="{{ url_for('route_oauth2_authorize', provider='google') }}" class="btn red" title="Login">Login</a>
				{% endif %}
			</div>
		</header>

		<script>
			document.getElementById("search-bar-input")?.addEventListener('keypress', function (event) {
				if (event.key === 'Enter') {
					const query = this.value;
					if (query) {
						window.location.href = `/search?query=${encodeURIComponent(query)}`;
					}
				}
			});

			const uploadButton = document.getElementById("upload-button");
			const modal = document.querySelector('.modal-overlay');
			const closeButton = document.getElementById("upload-modal-close-button");

			if (uploadButton && modal && closeButton) {
				uploadButton.addEventListener('click', () => modal.classList.add('active'));
				closeButton.addEventListener('click', () => modal.classList.remove('active'));

				modal.addEventListener('click', (e) => {
					if (e.target === modal) modal.classList.remove('active');
				});

				const uploadArea = document.querySelector('.upload-area');

				uploadArea.addEventListener('dragover', (e) => {
					e.preventDefault();
					uploadArea.classList.add('dragging');
				});

				uploadArea.addEventListener('dragleave', () => {
					uploadArea.classList.remove('dragging');
				});

				uploadArea.addEventListener('drop', (e) => {
					e.preventDefault();
					uploadArea.classList.remove('dragging');
					document.getElementById('file-upload').files = e.dataTransfer.files;
				});
			}
		</script>
	</body>
</html>
